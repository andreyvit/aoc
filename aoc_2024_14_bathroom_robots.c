#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <inttypes.h>

#define INPUT 1

#if INPUT == 1
	char *input = 
		"p=0,4 v=3,-3\n"
		"p=6,3 v=-1,-3\n"
		"p=10,3 v=-1,2\n"
		"p=2,0 v=2,-1\n"
		"p=0,0 v=1,3\n"
		"p=3,0 v=-2,-2\n"
		"p=7,6 v=-1,-3\n"
		"p=3,0 v=-1,-2\n"
		"p=9,3 v=2,3\n"
		"p=7,3 v=-1,2\n"
		"p=2,4 v=2,-3\n"
		"p=9,5 v=-3,-3\n"
	;
	#define MX 11
	#define MY 7
	#define MIDX 5
	#define MIDY 3
	#define SHOW 1

#elif INPUT == 2
	char *input = 
		"p=71,0 v=-12,-37\n"
		"p=31,67 v=-53,91\n"
		"p=53,49 v=-76,37\n"
		"p=28,19 v=-17,53\n"
		"p=41,55 v=-3,22\n"
		"p=41,57 v=98,15\n"
		"p=44,38 v=55,-51\n"
		"p=52,24 v=82,-1\n"
		"p=38,5 v=-51,52\n"
		"p=69,14 v=55,41\n"
		"p=91,73 v=-33,24\n"
		"p=26,74 v=-12,32\n"
		"p=36,66 v=85,84\n"
		"p=31,39 v=5,-26\n"
		"p=52,85 v=50,72\n"
		"p=70,81 v=97,-86\n"
		"p=90,23 v=-68,-42\n"
		"p=63,98 v=63,-77\n"
		"p=88,84 v=86,71\n"
		"p=20,8 v=93,87\n"
		"p=79,99 v=-16,26\n"
		"p=88,65 v=-77,94\n"
		"p=65,41 v=10,21\n"
		"p=13,21 v=-11,43\n"
		"p=78,56 v=56,-13\n"
		"p=59,66 v=63,-67\n"
		"p=84,84 v=4,-93\n"
		"p=36,63 v=-98,-94\n"
		"p=27,83 v=-46,65\n"
		"p=81,63 v=-65,-12\n"
		"p=51,49 v=-43,-67\n"
		"p=42,64 v=-96,2\n"
		"p=69,57 v=-69,-23\n"
		"p=71,24 v=52,47\n"
		"p=14,28 v=44,3\n"
		"p=57,44 v=-35,14\n"
		"p=92,43 v=-46,-67\n"
		"p=74,49 v=68,-24\n"
		"p=65,54 v=87,-47\n"
		"p=90,100 v=-52,24\n"
		"p=22,34 v=19,69\n"
		"p=12,66 v=6,-67\n"
		"p=44,87 v=21,-93\n"
		"p=9,40 v=-92,20\n"
		"p=11,45 v=59,1\n"
		"p=33,37 v=-33,-31\n"
		"p=75,42 v=68,-7\n"
		"p=78,30 v=-97,68\n"
		"p=61,80 v=-91,-59\n"
		"p=88,21 v=18,87\n"
		"p=61,57 v=-75,-66\n"
		"p=99,26 v=-55,-49\n"
		"p=71,87 v=59,35\n"
		"p=74,100 v=-90,-87\n"
		"p=39,98 v=-8,-78\n"
		"p=92,91 v=81,86\n"
		"p=2,88 v=-28,-4\n"
		"p=61,96 v=-33,-71\n"
		"p=93,17 v=-68,88\n"
		"p=64,95 v=87,58\n"
		"p=61,45 v=18,-20\n"
		"p=63,13 v=-49,19\n"
		"p=83,76 v=-44,30\n"
		"p=95,99 v=-38,37\n"
		"p=94,98 v=-57,87\n"
		"p=34,68 v=82,-4\n"
		"p=20,16 v=35,-42\n"
		"p=95,80 v=-68,65\n"
		"p=54,26 v=63,74\n"
		"p=20,75 v=-74,-31\n"
		"p=74,83 v=-53,-14\n"
		"p=0,46 v=-76,-68\n"
		"p=70,49 v=84,29\n"
		"p=41,42 v=69,83\n"
		"p=97,88 v=-52,-31\n"
		"p=95,92 v=17,24\n"
		"p=23,46 v=77,-53\n"
		"p=70,46 v=-9,76\n"
		"p=11,10 v=51,67\n"
		"p=13,15 v=-74,-56\n"
		"p=31,48 v=-96,-61\n"
		"p=26,31 v=-5,96\n"
		"p=58,51 v=-94,-63\n"
		"p=98,13 v=1,68\n"
		"p=36,55 v=-41,-7\n"
		"p=48,51 v=21,-47\n"
		"p=45,47 v=95,83\n"
		"p=11,91 v=59,-75\n"
		"p=87,66 v=41,57\n"
		"p=15,5 v=-51,-36\n"
		"p=56,101 v=47,-86\n"
		"p=24,86 v=-13,78\n"
		"p=17,94 v=-74,-71\n"
		"p=60,67 v=79,-87\n"
		"p=57,28 v=-92,-46\n"
		"p=61,46 v=-33,-41\n"
		"p=73,39 v=63,-26\n"
		"p=43,97 v=-53,94\n"
		"p=48,8 v=71,-33\n"
		"p=23,12 v=-97,-80\n"
		"p=13,73 v=19,-80\n"
		"p=76,30 v=-73,89\n"
		"p=75,86 v=-28,-25\n"
		"p=49,3 v=69,54\n"
		"p=11,90 v=6,-85\n"
		"p=70,10 v=36,27\n"
		"p=14,61 v=-5,-61\n"
		"p=91,73 v=33,84\n"
		"p=15,15 v=83,-36\n"
		"p=24,20 v=-21,-35\n"
		"p=99,80 v=-36,85\n"
		"p=83,40 v=-7,-6\n"
		"p=23,60 v=-29,98\n"
		"p=83,35 v=11,17\n"
		"p=50,89 v=93,-16\n"
		"p=60,26 v=55,-90\n"
		"p=13,20 v=-14,37\n"
		"p=21,57 v=-50,40\n"
		"p=77,67 v=14,4\n"
		"p=0,1 v=-23,-43\n"
		"p=93,85 v=-53,92\n"
		"p=69,17 v=76,-15\n"
		"p=88,41 v=-39,-28\n"
		"p=29,60 v=-77,77\n"
		"p=43,84 v=74,71\n"
		"p=87,58 v=97,43\n"
		"p=48,16 v=8,-55\n"
		"p=54,60 v=-95,83\n"
		"p=22,42 v=14,96\n"
		"p=12,44 v=59,62\n"
		"p=34,73 v=52,-4\n"
		"p=69,14 v=-54,-77\n"
		"p=64,96 v=51,-82\n"
		"p=32,31 v=-77,75\n"
		"p=49,25 v=50,-56\n"
		"p=57,47 v=74,-31\n"
		"p=25,11 v=64,60\n"
		"p=43,91 v=98,38\n"
		"p=56,102 v=-56,-44\n"
		"p=6,45 v=99,83\n"
		"p=27,13 v=11,-43\n"
		"p=74,102 v=52,94\n"
		"p=76,8 v=-30,2\n"
		"p=79,26 v=36,54\n"
		"p=54,95 v=26,-51\n"
		"p=90,13 v=12,-14\n"
		"p=55,0 v=-60,-27\n"
		"p=46,54 v=61,1\n"
		"p=4,74 v=56,20\n"
		"p=89,34 v=49,28\n"
		"p=97,78 v=-70,-68\n"
		"p=34,31 v=71,-76\n"
		"p=32,44 v=-45,-70\n"
		"p=27,68 v=75,-87\n"
		"p=96,37 v=28,65\n"
		"p=34,1 v=47,-53\n"
		"p=77,80 v=79,-44\n"
		"p=22,42 v=64,-29\n"
		"p=98,98 v=-23,-16\n"
		"p=5,8 v=46,88\n"
		"p=45,59 v=58,44\n"
		"p=73,5 v=-92,-88\n"
		"p=54,102 v=18,-64\n"
		"p=87,78 v=60,59\n"
		"p=31,65 v=37,65\n"
		"p=3,36 v=-47,69\n"
		"p=43,71 v=-19,77\n"
		"p=19,43 v=35,7\n"
		"p=64,34 v=9,23\n"
		"p=54,48 v=-43,84\n"
		"p=14,84 v=78,-58\n"
		"p=85,25 v=-33,47\n"
		"p=72,64 v=84,-66\n"
		"p=31,38 v=-69,-13\n"
		"p=35,84 v=85,-79\n"
		"p=80,19 v=-66,-92\n"
		"p=98,14 v=-68,-56\n"
		"p=81,80 v=-73,44\n"
		"p=79,34 v=46,34\n"
		"p=2,50 v=-98,60\n"
		"p=40,39 v=37,-89\n"
		"p=22,44 v=35,83\n"
		"p=80,66 v=55,23\n"
		"p=45,101 v=-11,-2\n"
		"p=81,79 v=4,11\n"
		"p=64,84 v=-82,-66\n"
		"p=40,92 v=-94,47\n"
		"p=25,100 v=-53,11\n"
		"p=48,16 v=18,-64\n"
		"p=33,11 v=60,2\n"
		"p=36,74 v=-45,-75\n"
		"p=40,70 v=-48,85\n"
		"p=31,19 v=-67,89\n"
		"p=19,5 v=-80,54\n"
		"p=18,70 v=-66,-11\n"
		"p=5,27 v=37,10\n"
		"p=56,17 v=-33,52\n"
		"p=18,86 v=8,4\n"
		"p=49,49 v=-10,-63\n"
		"p=51,71 v=-16,-51\n"
		"p=41,21 v=-56,-21\n"
		"p=89,102 v=41,31\n"
		"p=5,102 v=14,-98\n"
		"p=47,29 v=-59,-35\n"
		"p=28,70 v=78,38\n"
		"p=13,79 v=-79,2\n"
		"p=83,18 v=-25,-29\n"
		"p=74,41 v=-73,-82\n"
		"p=74,27 v=7,34\n"
		"p=65,11 v=60,-21\n"
		"p=79,21 v=34,-96\n"
		"p=1,100 v=-79,24\n"
		"p=22,27 v=80,-14\n"
		"p=27,24 v=75,-49\n"
		"p=69,32 v=31,75\n"
		"p=48,88 v=58,-38\n"
		"p=9,5 v=17,-57\n"
		"p=4,39 v=-44,7\n"
		"p=12,59 v=-10,15\n"
		"p=42,47 v=37,28\n"
		"p=71,101 v=7,-16\n"
		"p=45,38 v=13,-69\n"
		"p=5,101 v=-45,-88\n"
		"p=96,101 v=-84,45\n"
		"p=53,79 v=58,-25\n"
		"p=37,45 v=-91,-81\n"
		"p=23,61 v=-14,20\n"
		"p=22,91 v=-58,-10\n"
		"p=23,101 v=-13,25\n"
		"p=57,20 v=87,68\n"
		"p=53,48 v=-64,-55\n"
		"p=12,31 v=-10,-76\n"
		"p=31,80 v=5,-32\n"
		"p=63,11 v=-28,-5\n"
		"p=88,40 v=-81,-89\n"
		"p=44,10 v=45,-22\n"
		"p=0,91 v=41,-59\n"
		"p=43,52 v=26,-32\n"
		"p=96,89 v=77,46\n"
		"p=30,59 v=-50,70\n"
		"p=56,50 v=-99,-20\n"
		"p=26,83 v=-42,35\n"
		"p=22,9 v=-98,-22\n"
		"p=2,30 v=29,-46\n"
		"p=87,67 v=-73,-12\n"
		"p=43,8 v=69,5\n"
		"p=37,35 v=96,34\n"
		"p=22,29 v=35,96\n"
		"p=12,39 v=-95,97\n"
		"p=76,97 v=-57,45\n"
		"p=59,91 v=-99,73\n"
		"p=29,77 v=-42,52\n"
		"p=73,85 v=-66,43\n"
		"p=60,7 v=-25,6\n"
		"p=88,94 v=65,-99\n"
		"p=86,47 v=7,-34\n"
		"p=29,100 v=3,-70\n"
		"p=27,25 v=-98,29\n"
		"p=48,99 v=-5,-68\n"
		"p=9,25 v=80,-82\n"
		"p=57,20 v=-45,6\n"
		"p=77,5 v=30,96\n"
		"p=3,46 v=-55,-26\n"
		"p=61,52 v=55,-74\n"
		"p=19,63 v=43,91\n"
		"p=75,27 v=76,79\n"
		"p=3,91 v=65,-59\n"
		"p=88,82 v=57,73\n"
		"p=71,16 v=-86,-56\n"
		"p=53,86 v=31,73\n"
		"p=48,85 v=-35,-79\n"
		"p=100,76 v=9,-18\n"
		"p=54,37 v=16,39\n"
		"p=48,5 v=-11,95\n"
		"p=76,79 v=-58,78\n"
		"p=94,57 v=-47,-66\n"
		"p=43,10 v=-80,46\n"
		"p=64,12 v=82,-23\n"
		"p=78,20 v=36,68\n"
		"p=13,46 v=-58,-81\n"
		"p=23,9 v=-98,-43\n"
		"p=16,17 v=14,74\n"
		"p=7,76 v=46,-93\n"
		"p=39,10 v=-69,-54\n"
		"p=5,79 v=-14,2\n"
		"p=74,32 v=79,95\n"
		"p=66,76 v=-70,-59\n"
		"p=12,80 v=91,-62\n"
		"p=45,40 v=-88,8\n"
		"p=57,54 v=95,-95\n"
		"p=35,46 v=8,63\n"
		"p=17,68 v=43,9\n"
		"p=27,62 v=-85,3\n"
		"p=13,42 v=51,8\n"
		"p=82,88 v=-81,-51\n"
		"p=60,54 v=58,-40\n"
		"p=74,99 v=-25,-99\n"
		"p=80,7 v=-4,-29\n"
		"p=26,29 v=-56,89\n"
		"p=90,11 v=-52,-57\n"
		"p=45,87 v=-40,65\n"
		"p=26,39 v=47,92\n"
		"p=13,95 v=-74,-58\n"
		"p=11,50 v=42,-23\n"
		"p=96,99 v=91,-79\n"
		"p=78,18 v=63,-48\n"
		"p=6,92 v=3,11\n"
		"p=91,92 v=-44,-58\n"
		"p=61,54 v=-99,36\n"
		"p=32,36 v=24,34\n"
		"p=33,30 v=38,82\n"
		"p=6,65 v=38,9\n"
		"p=40,68 v=85,15\n"
		"p=50,93 v=-88,31\n"
		"p=42,3 v=-16,5\n"
		"p=48,83 v=37,-87\n"
		"p=98,102 v=14,-44\n"
		"p=40,68 v=-7,-24\n"
		"p=77,97 v=-86,93\n"
		"p=36,81 v=-48,-52\n"
		"p=22,84 v=-91,63\n"
		"p=11,60 v=-41,82\n"
		"p=17,42 v=84,79\n"
		"p=100,71 v=38,-32\n"
		"p=35,81 v=-24,-33\n"
		"p=82,64 v=-4,-73\n"
		"p=12,7 v=-11,-75\n"
		"p=28,71 v=-29,23\n"
		"p=74,4 v=36,-43\n"
		"p=4,90 v=19,24\n"
		"p=74,59 v=98,7\n"
		"p=3,94 v=95,95\n"
		"p=78,80 v=-9,-11\n"
		"p=97,38 v=9,-69\n"
		"p=53,27 v=-25,39\n"
		"p=83,74 v=36,51\n"
		"p=39,20 v=-59,-84\n"
		"p=89,75 v=46,-24\n"
		"p=37,98 v=72,26\n"
		"p=13,33 v=-42,21\n"
		"p=69,13 v=-99,70\n"
		"p=17,35 v=11,7\n"
		"p=54,38 v=-43,53\n"
		"p=68,27 v=39,-68\n"
		"p=70,96 v=-67,66\n"
		"p=31,83 v=-47,-75\n"
		"p=83,4 v=28,32\n"
		"p=19,20 v=-63,12\n"
		"p=100,42 v=-41,20\n"
		"p=52,52 v=14,-30\n"
		"p=90,50 v=4,97\n"
		"p=80,89 v=-28,-87\n"
		"p=74,58 v=-33,63\n"
		"p=62,54 v=10,70\n"
		"p=26,71 v=72,30\n"
		"p=0,12 v=59,66\n"
		"p=24,54 v=96,78\n"
		"p=69,52 v=-78,-32\n"
		"p=11,54 v=67,-12\n"
		"p=25,70 v=-10,-74\n"
		"p=76,41 v=58,-69\n"
		"p=16,99 v=83,73\n"
		"p=1,23 v=-58,-42\n"
		"p=65,71 v=-83,77\n"
		"p=34,23 v=-77,-8\n"
		"p=48,22 v=66,-83\n"
		"p=30,68 v=-57,-37\n"
		"p=58,28 v=-18,-74\n"
		"p=94,39 v=-76,-54\n"
		"p=2,95 v=6,-74\n"
		"p=29,10 v=56,-36\n"
		"p=9,66 v=17,30\n"
		"p=57,90 v=-64,-93\n"
		"p=18,3 v=-57,12\n"
		"p=75,96 v=18,39\n"
		"p=19,2 v=59,46\n"
		"p=87,65 v=73,-39\n"
		"p=39,26 v=-61,74\n"
		"p=16,59 v=41,83\n"
		"p=65,10 v=19,-27\n"
		"p=1,78 v=37,21\n"
		"p=6,84 v=-86,58\n"
		"p=56,21 v=72,74\n"
		"p=49,60 v=58,-89\n"
		"p=36,1 v=50,-33\n"
		"p=54,69 v=26,9\n"
		"p=36,40 v=56,-32\n"
		"p=56,49 v=-38,-68\n"
		"p=72,4 v=-49,6\n"
		"p=71,8 v=-65,94\n"
		"p=16,33 v=88,-28\n"
		"p=32,25 v=4,-86\n"
		"p=25,85 v=98,-12\n"
		"p=82,75 v=-18,4\n"
		"p=33,33 v=77,82\n"
		"p=58,101 v=-72,-91\n"
		"p=38,73 v=-24,-86\n"
		"p=4,60 v=19,-6\n"
		"p=38,93 v=78,-32\n"
		"p=5,63 v=30,89\n"
		"p=81,72 v=65,-94\n"
		"p=14,61 v=19,98\n"
		"p=21,8 v=-65,-90\n"
		"p=19,29 v=-1,-59\n"
		"p=6,51 v=14,32\n"
		"p=64,77 v=-34,-8\n"
		"p=83,100 v=-52,-70\n"
		"p=32,88 v=99,22\n"
		"p=36,8 v=21,5\n"
		"p=48,82 v=93,64\n"
		"p=84,67 v=-15,22\n"
		"p=18,9 v=30,-28\n"
		"p=20,80 v=-11,26\n"
		"p=21,83 v=51,25\n"
		"p=27,21 v=8,-63\n"
		"p=75,29 v=76,-48\n"
		"p=11,67 v=79,-23\n"
		"p=39,74 v=85,-66\n"
		"p=77,79 v=36,-31\n"
		"p=74,14 v=-49,-84\n"
		"p=26,21 v=-32,-5\n"
		"p=84,26 v=34,93\n"
		"p=17,16 v=99,19\n"
		"p=67,89 v=-22,-66\n"
		"p=89,56 v=63,66\n"
		"p=61,64 v=-14,-90\n"
		"p=28,76 v=29,-32\n"
		"p=16,54 v=35,-95\n"
		"p=80,94 v=-81,38\n"
		"p=26,73 v=80,-80\n"
		"p=25,64 v=64,-81\n"
		"p=16,22 v=62,6\n"
		"p=42,18 v=-83,13\n"
		"p=97,79 v=83,45\n"
		"p=94,35 v=-68,55\n"
		"p=59,102 v=95,-84\n"
		"p=77,84 v=-9,3\n"
		"p=62,54 v=-30,-19\n"
		"p=12,83 v=79,-14\n"
		"p=20,62 v=-30,-71\n"
		"p=26,3 v=-45,-36\n"
		"p=81,89 v=18,-23\n"
		"p=4,13 v=94,67\n"
		"p=80,31 v=53,39\n"
		"p=87,82 v=33,10\n"
		"p=15,9 v=67,95\n"
		"p=67,31 v=-71,19\n"
		"p=85,81 v=86,-12\n"
		"p=93,16 v=-83,-69\n"
		"p=15,67 v=68,-59\n"
		"p=8,59 v=-42,63\n"
		"p=68,9 v=53,24\n"
		"p=83,27 v=57,-83\n"
		"p=96,69 v=57,71\n"
		"p=26,28 v=45,-89\n"
		"p=42,32 v=35,94\n"
		"p=92,64 v=70,-74\n"
		"p=76,77 v=84,10\n"
		"p=72,61 v=68,-5\n"
		"p=53,82 v=31,18\n"
		"p=22,33 v=19,28\n"
		"p=66,19 v=-35,-14\n"
		"p=93,53 v=-60,43\n"
		"p=17,10 v=-92,93\n"
		"p=67,97 v=79,-95\n"
		"p=2,74 v=-79,44\n"
		"p=47,31 v=90,-82\n"
		"p=60,25 v=-88,-89\n"
		"p=83,59 v=44,-5\n"
		"p=77,46 v=92,-47\n"
		"p=6,84 v=-55,-23\n"
		"p=41,90 v=45,45\n"
		"p=52,49 v=58,-83\n"
		"p=89,17 v=74,48\n"
		"p=43,66 v=28,36\n"
		"p=68,21 v=95,40\n"
		"p=93,100 v=-60,11\n"
		"p=86,82 v=-20,-79\n"
		"p=59,25 v=18,20\n"
		"p=18,7 v=-34,-57\n"
		"p=30,19 v=9,-1\n"
		"p=48,80 v=98,-65\n"
		"p=66,100 v=-35,-98\n"
		"p=55,17 v=-5,35\n"
		"p=20,78 v=-74,-53\n"
		"p=41,2 v=26,-50\n"
		"p=23,57 v=69,29\n"
		"p=64,5 v=-46,46\n"
		"p=65,42 v=55,-75\n"
		"p=64,88 v=-70,85\n"
		"p=73,98 v=-91,25\n"
		"p=2,82 v=46,31\n"
		"p=80,69 v=-28,98\n"
		"p=3,30 v=-55,-49\n"
		"p=49,20 v=87,-50\n"
		"p=69,72 v=74,-31\n"
		"p=68,14 v=92,67\n"
		"p=73,102 v=-9,31\n"
		"p=24,18 v=48,-48\n"
		"p=46,5 v=-56,80\n"
	;
	#define MX 101
	#define MY 103
	#define MIDX 50
	#define MIDY 51
	#define SHOW 0

#elif INPUT == 3
	char *input = 
		"p=2,0 v=1,0\n"
		"p=10,0 v=-2,0\n"
	;
	#define MX 11
	#define MY 7
	#define MIDX 5
	#define MIDY 3
	#define SHOW 1
#endif
	
#define MAXN 1000
#define NSEC 100

typedef struct { int x, y, vx, vy; } ROBOT;
ROBOT robots[MAXN];
int crobots;
	
#define die(fmt, ...) do { fprintf(stderr, fmt "\n", ## __VA_ARGS__); exit(1); } while(0)
#define assert(cond) do { if(!(cond)) die("!assert " #cond); } while(0)
int overflow(int c, int m) {
	int r = c % m;
	return r + (c < 0 && r != 0 ? m : 0);
}

/* 0 1
   2 3 */
int quadrant(int x, int y) {
	if (x == MIDX || y == MIDY) return -1;
	if (y < MIDY) return (x < MIDX ? 0 : 1);
	else return (x < MIDX ? 2 : 3);
}

void read_input() {
	char *in = input;
	while (*in) {
		if (crobots == MAXN) {
			die("too many robots");
		}
		int nch = 0;
		ROBOT *r = &robots[crobots];
		int n = sscanf(in, "p=%d,%d v=%d,%d %n", &r->x, &r->y, &r->vx, &r->vy, &nch);
		if (n != 4) {
			die("sscanf=%d on %s", n, in);
		}
		in += nch;
		crobots++;
	}
	printf("n = %d, field = %dx%d\n", crobots, MX, MY);
}

void print_field() {
	static char field[MY][MX];
	for (int y = 0; y < MY; y++) {
		for (int x = 0; x < MX; x++) {
			field[y][x] = '.';
		}
	}
	for (ROBOT *r = robots; r < robots + crobots; r++) {
		if (r->x < 0 || r->x >= MX || r->y < 0 || r->y >= MY) {
			die("invalid robot pos %d %d", r->x, r->y);
		}
		char c = field[r->y][r->x];
		if (c == '.') {
			c = '1';
		} else {
			c++;
		}
		field[r->y][r->x] = c;
	}
	for (int y = 0; y < MY; y++) {
		for (int x = 0; x < MX; x++) {
			putchar(field[y][x]);
		}
		putchar('\n');
	}
}

int is_christmas_tree() {
	static char field[MY][MX];
	for (int y = 0; y < MY; y++) {
		for (int x = 0; x < MX; x++) {
			field[y][x] = '.';
		}
	}
	for (ROBOT *r = robots; r < robots + crobots; r++) {
		if (r->x < 0 || r->x >= MX || r->y < 0 || r->y >= MY) {
			die("invalid robot pos %d %d", r->x, r->y);
		}
		field[r->y][r->x] = '*';
	}
	for (int y = 0; y < MY; y++) {
		char *row = field[y];
		for (int x = 0; x < MIDX; x++) {
			if (row[x] != row[MX-x-1]) {
				return 0;
			}
		}
	}
	return 1;
}

void solve_part_one() {
	if (SHOW) {
		printf("\nBEFORE:\n");
		print_field();
	}
	
	int64_t qq[4] = {0};
	for (ROBOT *r = robots; r < robots + crobots; r++) {
		int old_x = r->x, old_y = r->y;
		r->x = overflow(r->x + r->vx * NSEC, MX);
		r->y = overflow(r->y + r->vy * NSEC, MY);
		int q = quadrant(r->x, r->y);
		if (q >= 0) {
			qq[q]++;
		}
		//printf("(%d, %d) -> (%d, %d)\n", old_x, old_y, r->x, r->y);
	}
	if (SHOW) {
		printf("\nAFTER:\n");
		print_field();
	}
	
	int64_t safety = qq[0] * qq[1] * qq[2] * qq[3];
	printf("safety = %" PRId64 "\n", safety);
}

#define CLEAR_PROGRESS "\r          \r"

void solve_part_two() {
	int64_t t = 0;
	for (;; t++) {
		int64_t qq[4] = {0};
		for (ROBOT *r = robots; r < robots + crobots; r++) {
			r->x = overflow(r->x + r->vx, MX);
			r->y = overflow(r->y + r->vy, MY);
			int q = quadrant(r->x, r->y);
			if (q >= 0) {
				qq[q]++;
			}
		}
		if (qq[0] == qq[1] && qq[2] == qq[3] && is_christmas_tree()) {
			printf(CLEAR_PROGRESS "\nt = %" PRId64 ":\n", t);
			print_field();
			putchar('\n');
		} else if (t % 1000000 == 0) {
			printf(CLEAR_PROGRESS "t = %" PRId64, t);
			fflush(stdout);
		}
	}
	// printf("\n\nsearched till t = %" PRId64 "\n", t);
}

int main(int argc, char *argv[]) {
	assert(overflow(3, 7) == 3);
	assert(overflow(11, 7) == 4);
	assert(overflow(-11, 7) == 3);
	assert(overflow(6-100*3, 7) == 0);
	read_input();
	solve_part_two();
	return 0;
}
